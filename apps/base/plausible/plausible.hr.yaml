apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: plausible
  namespace: default
spec:
  interval: 5m
  chart:
    spec:
      chart: plausible
      version: 2.1.0
      sourceRef:
        kind: HelmRepository
        name: pascaliske-charts
        namespace: default
  dependsOn:
    - name: plausible-postgresql-cnpg
      namespace: default
    - name: plausible-clickhouse
      namespace: default
  values:
    image:
      repository: ghcr.io/plausible/community-edition
    # Disable internal database deployments
    postgresql:
      enabled: false
    clickhouse:
      enabled: false
    # External PostgreSQL configuration (CloudNativePG)
    externalPostgresql:
      host: plausible-postgresql-cnpg-cluster-rw
      port: 5432
      database: plausible
      username: plausible
    # External ClickHouse configuration
    externalClickhouse:
      host: plausible-clickhouse
      port: 8123
      database: plausible
      username: plausible
    ingress:
      enabled: true
    service:
      main:
        ports:
          http:
            port: 8000

